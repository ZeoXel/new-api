[SYS] 2025/10/16 - 18:13:37 | initializing token encoders 
[SYS] 2025/10/16 - 18:13:37 | token encoders initialized 
[SYS] 2025/10/16 - 18:13:37 | SQL_DSN not set, using SQLite as database 
[SYS] 2025/10/16 - 18:13:37 | database migration started 
[SYS] 2025/10/16 - 18:13:37 | system is already initialized at: 2025-10-10 14:30:09 +0800 CST 
[SYS] 2025/10/16 - 18:13:37 | REDIS_CONN_STRING not set, Redis is not enabled 
[SYS] 2025/10/16 - 18:13:37 | New API v0.0.0 started 
[SYS] 2025/10/16 - 18:13:37 | running in debug mode 
[SYS] 2025/10/16 - 18:13:37 | æ­£åœ¨æ›´æ–°æ•°æ®çœ‹æ¿æ•°æ®... 
[SYS] 2025/10/16 - 18:13:37 | ä¿å­˜æ•°æ®çœ‹æ¿æ•°æ®æˆåŠŸï¼Œå…±ä¿å­˜0æ¡æ•°æ® 
[SYS] 2025/10/16 - 18:13:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:13:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:14:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:14:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:14:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:14:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:14:37 | syncing options from database 
[SYS] 2025/10/16 - 18:14:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:14:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:14:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:14:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:15:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:15:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:15:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:15:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:15:37 | syncing options from database 
[SYS] 2025/10/16 - 18:15:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:15:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:15:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:15:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:16:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:16:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:16:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:16:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:16:37 | syncing options from database 
[SYS] 2025/10/16 - 18:16:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:16:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:16:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:16:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:17:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:17:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:17:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:17:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:17:37 | syncing options from database 
[SYS] 2025/10/16 - 18:17:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:17:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:17:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[SYS] 2025/10/16 - 18:17:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[INFO] 2025/10/16 - 18:18:04 | 202510161818048865510006o45LGlo | ç”¨æˆ· 1 é¢åº¦å……è¶³ä¸”ä¸ºæ— é™é¢åº¦ä»¤ç‰Œ, ä¿¡ä»»ä¸”ä¸éœ€è¦é¢„æ‰£è´¹ 
[SYS] 2025/10/16 - 18:18:04 | [Async] Detected async workflow request: model=coze-workflow-async, stream=false 
[DEBUG] 2025/10/16 - 18:18:04 | 202510161818048865510006o45LGlo | text request body: null 
[SYS] 2025/10/16 - 18:18:04 | DoRequest called with OriginModelName: coze-workflow-async 
[SYS] 2025/10/16 - 18:18:04 | [Async] Processing async workflow request in DoRequest 
[SYS] 2025/10/16 - 18:18:04 | [Async] Created task chatcmpl-202510161818048865510006o45LGlo for workflow 7549076385299333172 
[SYS] 2025/10/16 - 18:18:04 | [Async] Response already sent, skipping DoResponse 
[SYS] 2025/10/16 - 18:18:04 | [Async] Starting background execution for task chatcmpl-202510161818048865510006o45LGlo 
[SYS] 2025/10/16 - 18:18:04 | å‘é€ç»™Cozeçš„å·¥ä½œæµè¯·æ±‚: {"workflow_id":"7549076385299333172","parameters":{"BOT_USER_INPUT":"æµ‹è¯•å¼‚æ­¥æ‰§è¡Œ","input":"æ¨èä¸€æ¬¾æ™ºèƒ½æ‰‹æœº"}} 
[SYS] 2025/10/16 - 18:18:04 | [OAuth Debug] ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹ç”Ÿæˆæ–° token 
[SYS] 2025/10/16 - 18:18:04 | [OAuth Debug] JWT ç­¾åæˆåŠŸ (å‰50å­—ç¬¦): eyJhbGciOiJSUzI1NiIsImtpZCI6Im9rQ0UzWE95TXZDeDlwNU... 
[SYS] 2025/10/16 - 18:18:04 | [OAuth Debug] å‘ https://api.coze.cn/api/permission/oauth2/token å‘é€ token äº¤æ¢è¯·æ±‚ 


[31m2025/10/16 18:18:04 [Recovery] 2025/10/16 - 18:18:04 panic recovered:
interface conversion: interface {} is nil, not *dto.Usage
/opt/homebrew/Cellar/go/1.24.6/libexec/src/runtime/iface.go:275 (0x1001f1867)
	panicdottypeE: panic(&TypeAssertionError{iface, have, want, ""})
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/relay/compatible_handler.go:180 (0x100d64e77)
	TextHelper: postConsumeQuota(c, info, usage.(*dto.Usage), "")
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/controller/relay.go:48 (0x100de26ef)
	relayHandler: err = relay.TextHelper(c, info)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/controller/relay.go:174 (0x100de2f27)
	Relay: newAPIError = relayHandler(c, relayInfo)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/router/relay-router.go:92 (0x100e10ff7)
	SetRelayRouter.func8: controller.Relay(c, types.RelayFormatOpenAI)
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/distributor.go:121 (0x100e1a79f)
	SetRelayRouter.Distribute.func34: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/model-rate-limit.go:170 (0x100e19a03)
	SetRelayRouter.ModelRequestRateLimit.func32: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/auth.go:313 (0x100e1979f)
	SetRelayRouter.TokenAuth.func31: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/stats.go:27 (0x100e16b23)
	SetRelayRouter.StatsMiddleware.func25: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/gzip.go:36 (0x100e16877)
	SetRelayRouter.DecompressRequestMiddleware.func24: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/go/pkg/mod/github.com/gin-contrib/sessions@v0.0.5/sessions.go:54 (0x100e3d8eb)
	main.Sessions.func8: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x1007188ef)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 (0x1007188d0)
	LoggerWithConfig.func1: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x10070de0b)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/Desktop/å·¥ä½œ/ç»Ÿä¸€APIç½‘å…³/new-api/middleware/request-id.go:16 (0x100e3e3e7)
	main.RequestId.func7: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x100719527)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 (0x10071950c)
	CustomRecoveryWithWriter.func1: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 (0x100717e73)
	(*Context).Next: c.handlers[c.index](c)
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 (0x100717bac)
	(*Engine).handleHTTPRequest: c.Next()
/Users/g/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 (0x1007177ef)
	(*Engine).ServeHTTP: engine.handleHTTPRequest(c)
/opt/homebrew/Cellar/go/1.24.6/libexec/src/net/http/server.go:3301 (0x1004d3ebb)
	serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)
/opt/homebrew/Cellar/go/1.24.6/libexec/src/net/http/server.go:2102 (0x1004b4d3b)
	(*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)
/opt/homebrew/Cellar/go/1.24.6/libexec/src/runtime/asm_arm64.s:1223 (0x10025cb93)
	goexit: MOVD	R0, R0	// NOP
[0m
[SYS] 2025/10/16 - 18:18:04 | panic detected: interface conversion: interface {} is nil, not *dto.Usage 
[SYS] 2025/10/16 - 18:18:05 | [OAuth Debug] Token äº¤æ¢å“åº”çŠ¶æ€: 200, å“åº”ä½“: {"access_token":"czs_l8Hleq4ZfjtTfs0Ux6BB7dcZYfzHIamU8KXkRFmR9jaZYgM3OHPCj1ESEhtlhtM7j","expires_in":1760610785,"token_type":"Bearer"} 
[SYS] 2025/10/16 - 18:18:05 | [OAuth Debug] Access token è·å–æˆåŠŸ (å‰20å­—ç¬¦): czs_l8Hleq4ZfjtTfs0U... 
[SYS] 2025/10/16 - 18:18:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:18:07 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:18:07 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:18:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:18:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:18:22 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:18:22 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:18:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:18:37 | æ­£åœ¨æ›´æ–°æ•°æ®çœ‹æ¿æ•°æ®... 
[SYS] 2025/10/16 - 18:18:37 | ä¿å­˜æ•°æ®çœ‹æ¿æ•°æ®æˆåŠŸï¼Œå…±ä¿å­˜0æ¡æ•°æ® 
[SYS] 2025/10/16 - 18:18:37 | syncing options from database 
[SYS] 2025/10/16 - 18:18:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:18:37 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:18:37 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:18:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:18:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:18:52 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:18:52 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:18:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:19:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:19:07 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:19:07 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:19:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:19:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:19:22 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:19:22 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:19:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:19:37 | syncing options from database 
[SYS] 2025/10/16 - 18:19:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:19:37 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:19:37 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:19:37 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:19:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:19:52 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:19:52 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:19:52 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:20:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:20:07 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:20:07 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:20:07 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
[SYS] 2025/10/16 - 18:20:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å¼€å§‹ 
[INFO] 2025/10/16 - 18:20:22 | SYSTEM | Channel #8 pending video tasks: 1 
[ERR] 2025/10/16 - 18:20:22 | SYSTEM | Channel #8 failed to update video async tasks: video adaptor not found 
[SYS] 2025/10/16 - 18:20:22 | ä»»åŠ¡è¿›åº¦è½®è¯¢å®Œæˆ 
